<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ERP ุงูุดุงูู (ูุงููุฉ - ูุฎุฒูู - ูุญุงุณุจุฉ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f3f4f6; }
        .currency { font-family: 'Courier New', Courier, monospace; font-weight: bold; }
        .section-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .section-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        th { white-space: nowrap; }
    </style>
</head>
<body class="text-gray-800 h-screen flex overflow-hidden">

    <!-- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ -->
    <aside class="w-64 bg-slate-900 text-white flex flex-col shadow-lg transition-all duration-300 z-20" id="sidebar">
        <div class="p-6 border-b border-slate-700 flex items-center justify-center flex-col">
            <h1 class="text-2xl font-bold text-blue-400"><i class="fas fa-cube me-2"></i>ูุธุงู ERP</h1>
            <span class="text-xs text-purple-400 block mt-1">ุงูุฅุตุฏุงุฑ ุงูุดุงูู V4.0 โจ</span>
        </div>
        
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <button onclick="showSection('dashboard')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center bg-slate-800 text-blue-300" data-target="dashboard">
                <i class="fas fa-chart-pie w-6 text-center ml-2"></i> ููุญุฉ ุงูููุงุฏุฉ
            </button>
            <button onclick="showSection('finance')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center" data-target="finance">
                <i class="fas fa-landmark w-6 text-center ml-2"></i> ุงููุงููุฉ (ุฎุฒููุฉ ูุจููู)
            </button>
            <button onclick="showSection('inventory')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center" data-target="inventory">
                <i class="fas fa-boxes w-6 text-center ml-2"></i> ุงููุฎุฒูู
            </button>
            <button onclick="showSection('sales')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center" data-target="sales">
                <i class="fas fa-shopping-cart w-6 text-center ml-2"></i> ุงููุจูุนุงุช ูุงูุฅูุฑุงุฏุงุช
            </button>
            <button onclick="showSection('expenses')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center" data-target="expenses">
                <i class="fas fa-file-invoice w-6 text-center ml-2"></i> ุงููุตุฑููุงุช
            </button>
            <button onclick="showSection('purchases')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center" data-target="purchases">
                <i class="fas fa-truck w-6 text-center ml-2"></i> ุงููุดุชุฑูุงุช
            </button>
            <button onclick="showSection('accounting')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center" data-target="accounting">
                <i class="fas fa-calculator w-6 text-center ml-2"></i> ุงููุญุงุณุจุฉ ูุงูุชูุงุฑูุฑ
            </button>
        </nav>
    </aside>

    <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
    <main class="flex-1 flex flex-col overflow-hidden bg-gray-50">
        <!-- ุฑุฃุณ ุงูุตูุญุฉ -->
        <header class="bg-white shadow-sm p-4 flex justify-between items-center z-10 border-b">
            <h2 id="page-title" class="text-xl font-bold text-gray-700">ููุญุฉ ุงูููุงุฏุฉ</h2>
            <div class="flex items-center gap-4">
                <div class="flex gap-2 text-xs font-bold">
                    <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full border border-green-200">
                        <i class="fas fa-wallet me-1"></i> ุฎุฒููุฉ: <span id="header-cash" class="currency">0.00</span>
                    </span>
                    <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full border border-blue-200">
                        <i class="fas fa-university me-1"></i> ุจููู: <span id="header-bank" class="currency">0.00</span>
                    </span>
                </div>
                <button onclick="resetData()" class="text-red-500 text-sm hover:underline"><i class="fas fa-trash-alt"></i> ุชุตููุฑ</button>
            </div>
        </header>

        <!-- ููุทูุฉ ุงูุนูู -->
        <div class="flex-1 overflow-auto p-6 relative">
            
            <!-- 1. ููุญุฉ ุงูููุงุฏุฉ -->
            <section id="dashboard" class="section-content active">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border-r-4 border-green-500">
                        <p class="text-sm text-gray-500 mb-1">ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช</p>
                        <h3 class="text-2xl font-bold text-gray-800 currency" id="dash-revenue">0.00</h3>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border-r-4 border-red-500">
                        <p class="text-sm text-gray-500 mb-1">ุฅุฌูุงูู ุงููุตุฑููุงุช</p>
                        <h3 class="text-2xl font-bold text-gray-800 currency" id="dash-expenses">0.00</h3>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border-r-4 border-blue-500">
                        <p class="text-sm text-gray-500 mb-1">ุตุงูู ุงูุณูููุฉ (ููุฏ ูุจููู)</p>
                        <h3 class="text-2xl font-bold text-blue-600 currency" id="dash-liquidity">0.00</h3>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border-r-4 border-purple-500">
                        <p class="text-sm text-gray-500 mb-1">ุตุงูู ุงูุฑุจุญ</p>
                        <h3 class="text-2xl font-bold text-purple-600 currency" id="dash-net-profit">0.00</h3>
                    </div>
                </div>

                <!-- ุงูุฑุณู ุงูุจูุงูู ุงููุจุณุท ูููุตุฑููุงุช -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">๐ ุชูุฒูุน ุงููุตุฑููุงุช</h3>
                        <div id="expenses-breakdown" class="space-y-3">
                            <!-- ุณูุชู ุงูุชุนุจุฆุฉ ุจุงูุฌุงูุงุณูุฑูุจุช -->
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">โ๏ธ ุชูุจููุงุช ุงููุฎุฒูู ูุงูุฐูู</h3>
                        <div id="alerts-container" class="space-y-2 text-sm text-gray-600"></div>
                    </div>
                </div>
            </section>

            <!-- 2. ุงููุงููุฉ (ุงูุฎุฒููุฉ ูุงูุจููู) -->
            <section id="finance" class="section-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- ุฃุฑุตุฏุฉ ุงูุจููู -->
                    <div class="lg:col-span-1 space-y-4">
                        <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-green-500">
                            <h3 class="font-bold text-lg mb-2 text-gray-700"><i class="fas fa-wallet me-2"></i>ุงูุฎุฒููุฉ ุงูุฑุฆูุณูุฉ</h3>
                            <p class="text-3xl font-bold text-green-700 currency text-center mt-4" id="treasury-balance">0.00</p>
                            <p class="text-xs text-gray-400 text-center mt-2">ุงูููุฏูุฉ ุงููุชุงุญุฉ ูู ุงูุตูุฏูู</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-blue-500">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-bold text-lg text-gray-700"><i class="fas fa-university me-2"></i>ุงูุญุณุงุจุงุช ุงูุจูููุฉ</h3>
                                <button onclick="addBank()" class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded hover:bg-blue-200">+ ุฅุถุงูุฉ ุจูู</button>
                            </div>
                            <div id="banks-list" class="space-y-3">
                                <!-- ูุงุฆูุฉ ุงูุจููู -->
                            </div>
                        </div>
                    </div>

                    <!-- ุญุฑูุฉ ุงูุฃููุงู -->
                    <div class="lg:col-span-2">
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <h3 class="font-bold text-lg mb-4 text-gray-700">ุณุฌู ุญุฑูุฉ ุงูุฃููุงู (ุฎุฒููุฉ ูุจููู)</h3>
                            <div class="overflow-x-auto max-h-96 overflow-y-auto">
                                <table class="w-full text-sm text-right">
                                    <thead class="bg-gray-100 text-gray-600 sticky top-0">
                                        <tr>
                                            <th class="p-3">ุงูุชุงุฑูุฎ</th>
                                            <th class="p-3">ููุน ุงูุญุฑูุฉ</th>
                                            <th class="p-3">ุงูุจูุงู</th>
                                            <th class="p-3">ุงููุจูุบ</th>
                                            <th class="p-3">ุงูุญุณุงุจ ุงููุชุฃุซุฑ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="finance-log-body" class="divide-y"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. ุงููุจูุนุงุช ูุงูุฅูุฑุงุฏุงุช -->
            <section id="sales" class="section-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- ุจูุน ููุชุฌุงุช -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-green-100">
                        <h3 class="font-bold text-gray-700 border-b pb-2 mb-4">๐ฆ ูุงุชูุฑุฉ ุจูุน ููุชุฌุงุช</h3>
                        <form onsubmit="processTransaction(event, 'sale')" class="space-y-3">
                            <div class="grid grid-cols-2 gap-2">
                                <input type="text" id="sale-customer" placeholder="ุงุณู ุงูุนููู" class="w-full p-2 border rounded text-sm">
                                <select id="sale-payment-method" class="w-full p-2 border rounded text-sm bg-white"></select>
                            </div>
                            <div class="grid grid-cols-3 gap-2">
                                <select id="sale-product" class="col-span-2 w-full p-2 border rounded text-sm bg-white" onchange="updatePrice('sale')"></select>
                                <input type="number" id="sale-qty" value="1" min="1" class="w-full p-2 border rounded text-sm" placeholder="ุงููููุฉ">
                            </div>
                            <button type="submit" class="w-full bg-green-600 text-white py-2 rounded text-sm hover:bg-green-700">ุชุณุฌูู ุงูุจูุน</button>
                        </form>
                    </div>
                    
                    <!-- ุฅูุฑุงุฏุงุช ุฎุฏูุงุช/ุฃุฎุฑู -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-indigo-100">
                        <h3 class="font-bold text-gray-700 border-b pb-2 mb-4">๐๏ธ ุฅูุฑุงุฏุงุช ุฎุฏูุงุช / ุฃุฎุฑู</h3>
                        <form onsubmit="processServiceRevenue(event)" class="space-y-3">
                            <div class="grid grid-cols-2 gap-2">
                                <input type="text" id="srv-desc" placeholder="ูุตู ุงูุฎุฏูุฉ/ุงูุฅูุฑุงุฏ" required class="w-full p-2 border rounded text-sm">
                                <select id="srv-type" class="w-full p-2 border rounded text-sm bg-white">
                                    <option value="services_rev">ุฅูุฑุงุฏ ุฎุฏูุงุช</option>
                                    <option value="other_rev">ุฅูุฑุงุฏุงุช ุฃุฎุฑู/ุนูููุงุช</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="number" id="srv-amount" placeholder="ุงููุจูุบ" required step="0.01" class="w-full p-2 border rounded text-sm">
                                <select id="srv-payment-method" class="w-full p-2 border rounded text-sm bg-white"></select>
                            </div>
                            <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded text-sm hover:bg-indigo-700">ุชุณุฌูู ุงูุฅูุฑุงุฏ</button>
                        </form>
                    </div>
                </div>
                
                <!-- ุณุฌู ุงููุจูุนุงุช -->
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="font-bold text-gray-700 mb-4">ุณุฌู ุงูุนูููุงุช (ูุจูุนุงุช ูุฎุฏูุงุช)</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-right">
                            <thead class="bg-green-50 text-green-800">
                                <tr>
                                    <th class="p-3">ุงูุชุงุฑูุฎ</th>
                                    <th class="p-3">ุงูููุน</th>
                                    <th class="p-3">ุงูุจูุงู/ุงูุนููู</th>
                                    <th class="p-3">ุงููุจูุบ</th>
                                    <th class="p-3">ุงูุถุฑูุจุฉ</th>
                                    <th class="p-3">ุทุฑููุฉ ุงูุฏูุน</th>
                                </tr>
                            </thead>
                            <tbody id="sales-log-body" class="divide-y"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 4. ุงููุตุฑููุงุช -->
            <section id="expenses" class="section-content">
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6 max-w-2xl mx-auto border-t-4 border-red-500">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">๐ธ ุชุณุฌูู ูุตุฑูู ุฌุฏูุฏ</h3>
                    <form onsubmit="processExpense(event)" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs text-gray-500 block mb-1">ููุน ุงููุตุฑูู</label>
                                <select id="exp-category" class="w-full p-2 border rounded text-sm bg-white">
                                    <optgroup label="ูุตุฑููุงุช ุชุดุบูููุฉ">
                                        <option value="exp_rent">ุฅูุฌุงุฑุงุช</option>
                                        <option value="exp_utilities">ููุฑุจุงุก ูููุงู ูุฅูุชุฑูุช</option>
                                        <option value="exp_maint">ุตูุงูุฉ</option>
                                    </optgroup>
                                    <optgroup label="ูุตุฑููุงุช ุฅุฏุงุฑูุฉ">
                                        <option value="exp_salaries">ุฑูุงุชุจ ูุฃุฌูุฑ</option>
                                        <option value="exp_office">ูุณุชูุฒูุงุช ููุชุจูุฉ</option>
                                    </optgroup>
                                    <optgroup label="ูุตุฑููุงุช ุชุณููููุฉ">
                                        <option value="exp_marketing">ุฅุนูุงูุงุช ูุชุณููู</option>
                                    </optgroup>
                                    <optgroup label="ุฃุฎุฑู">
                                        <option value="exp_trans">ููู ูุดุญู</option>
                                        <option value="exp_bank">ูุตุฑููุงุช ุจูููุฉ</option>
                                        <option value="exp_other">ูุตุฑููุงุช ูุชููุนุฉ</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs text-gray-500 block mb-1">ุทุฑููุฉ ุงูุฏูุน</label>
                                <select id="exp-payment-method" class="w-full p-2 border rounded text-sm bg-white"></select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs text-gray-500 block mb-1">ุงููุจูุบ (ุดุงูู ุงูุถุฑูุจุฉ ุฅู ูุฌุฏุช)</label>
                                <input type="number" id="exp-amount" required step="0.01" class="w-full p-2 border rounded text-sm">
                            </div>
                            <div>
                                <label class="text-xs text-gray-500 block mb-1">ุงูุจูุงู (ุดุฑุญ)</label>
                                <input type="text" id="exp-desc" placeholder="ุชูุงุตูู ุงููุตุฑูู..." required class="w-full p-2 border rounded text-sm">
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 shadow">ุชุณุฌูู ุงููุตุฑูู</button>
                    </form>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="font-bold text-gray-700 mb-4">ุณุฌู ุงููุตุฑููุงุช</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-right">
                            <thead class="bg-red-50 text-red-800">
                                <tr>
                                    <th class="p-3">ุงูุชุงุฑูุฎ</th>
                                    <th class="p-3">ุงูุชุตููู</th>
                                    <th class="p-3">ุงูุจูุงู</th>
                                    <th class="p-3">ุงููุจูุบ</th>
                                    <th class="p-3">ุทุฑููุฉ ุงูุฏูุน</th>
                                </tr>
                            </thead>
                            <tbody id="expenses-log-body" class="divide-y"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 5. ุงููุดุชุฑูุงุช -->
            <section id="purchases" class="section-content">
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                    <h3 class="font-bold text-gray-700 border-b pb-2 mb-4">๐ ูุงุชูุฑุฉ ูุดุชุฑูุงุช</h3>
                    <form onsubmit="processTransaction(event, 'purchase')" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <input type="text" id="purchase-supplier" placeholder="ุงุณู ุงูููุฑุฏ" class="w-full p-2 border rounded text-sm">
                        <select id="purchase-product" class="w-full p-2 border rounded text-sm bg-white" onchange="updatePrice('purchase')"></select>
                        <input type="number" id="purchase-qty" value="1" min="1" class="w-full p-2 border rounded text-sm" placeholder="ุงููููุฉ">
                        <select id="purchase-payment-method" class="w-full p-2 border rounded text-sm bg-white"></select>
                        <button type="submit" class="bg-blue-600 text-white py-2 rounded text-sm hover:bg-blue-700 w-full md:col-span-4">ุชุณุฌูู ุงููุดุชุฑูุงุช</button>
                    </form>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm">
                     <h3 class="font-bold text-gray-700 mb-4">ุณุฌู ุงููุดุชุฑูุงุช</h3>
                     <table class="w-full text-sm text-right">
                        <thead class="bg-blue-50 text-blue-800">
                            <tr><th>ุงูุชุงุฑูุฎ</th><th>ุงูููุฑุฏ</th><th>ุงูููุชุฌ</th><th>ุงููุจูุบ</th><th>ุงูุถุฑูุจุฉ</th><th>ุงูุฏูุน</th></tr>
                        </thead>
                        <tbody id="purchases-log-body" class="divide-y"></tbody>
                     </table>
                </div>
            </section>

            <!-- 6. ุงููุฎุฒูู -->
            <section id="inventory" class="section-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-sm">
                        <h3 class="font-bold text-lg mb-4 text-gray-700">ุฅุถุงูุฉ ุตูู</h3>
                        <form onsubmit="addProduct(event)" class="space-y-3">
                            <input type="text" id="prod-name" required class="w-full p-2 border rounded text-sm" placeholder="ุงุณู ุงูููุชุฌ">
                            <div class="grid grid-cols-2 gap-2">
                                <input type="number" id="prod-cost" placeholder="ุงูุชูููุฉ" step="0.01" required class="w-full p-2 border rounded text-sm">
                                <input type="number" id="prod-price" placeholder="ุณุนุฑ ุงูุจูุน" step="0.01" required class="w-full p-2 border rounded text-sm">
                            </div>
                            <input type="number" id="prod-stock" value="0" placeholder="ุฑุตูุฏ ุงูุชุชุงุญู" class="w-full p-2 border rounded text-sm">
                            <button type="submit" class="w-full bg-slate-700 text-white py-2 rounded text-sm hover:bg-slate-800">ุญูุธ</button>
                        </form>
                    </div>
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm">
                        <table class="w-full text-sm text-right">
                            <thead class="bg-gray-100"><tr><th>ุงูููุชุฌ</th><th>ุงูุชูููุฉ</th><th>ุงูุจูุน</th><th>ุงููููุฉ</th><th>ุงููููุฉ</th></tr></thead>
                            <tbody id="inventory-body" class="divide-y"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 7. ุงููุญุงุณุจุฉ ูุงูุชูุงุฑูุฑ -->
            <section id="accounting" class="section-content">
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6 border-b pb-4">ูุงุฆูุฉ ุงูุฏุฎู (ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ)</h2>
                    
                    <div class="space-y-3 text-sm md:text-base">
                        <!-- ุงูุฅูุฑุงุฏุงุช -->
                        <div class="bg-green-50 p-3 rounded font-bold text-green-800 mb-2">ุงูุฅูุฑุงุฏุงุช</div>
                        <div class="flex justify-between px-4"><span>ุฅูุฑุงุฏุงุช ุงููุจูุนุงุช (ุงูููุชุฌุงุช)</span><span id="rpt-sales">0.00</span></div>
                        <div class="flex justify-between px-4"><span>ุฅูุฑุงุฏุงุช ุงูุฎุฏูุงุช</span><span id="rpt-services">0.00</span></div>
                        <div class="flex justify-between px-4"><span>ุฅูุฑุงุฏุงุช ุฃุฎุฑู</span><span id="rpt-other-rev">0.00</span></div>
                        <div class="flex justify-between px-4 font-bold border-t border-green-200 pt-1"><span>ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช</span><span id="rpt-total-rev">0.00</span></div>

                        <!-- ุงูุชูุงููู -->
                        <div class="flex justify-between px-4 text-red-600 mt-2"><span>(-) ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ (COGS)</span><span id="rpt-cogs">0.00</span></div>
                        
                        <!-- ูุฌูู ุงูุฑุจุญ -->
                        <div class="flex justify-between px-4 font-bold text-lg bg-indigo-50 p-2 rounded mt-2"><span>ูุฌูู ุงูุฑุจุญ</span><span id="rpt-gross-profit" class="text-indigo-700">0.00</span></div>

                        <!-- ุงููุตุฑููุงุช ุงูุชุดุบูููุฉ ูุงูุฅุฏุงุฑูุฉ -->
                        <div class="bg-red-50 p-3 rounded font-bold text-red-800 mt-4 mb-2">ุงููุตุฑููุงุช</div>
                        <div id="rpt-expenses-list" class="space-y-1 px-4 text-gray-600">
                            <!-- ุณูุชู ุชุนุจุฆุชูุง ุฏููุงููููุงู -->
                        </div>
                        <div class="flex justify-between px-4 font-bold border-t border-red-200 pt-1 mt-2"><span>ุฅุฌูุงูู ุงููุตุฑููุงุช</span><span id="rpt-total-exp">0.00</span></div>

                        <!-- ุตุงูู ุงูุฑุจุญ -->
                        <div class="border-t-4 border-gray-800 mt-6 pt-4">
                            <div class="flex justify-between text-2xl font-bold">
                                <span>ุตุงูู ุงูุฑุจุญ / (ุงูุฎุณุงุฑุฉ)</span>
                                <span id="rpt-net-profit" class="text-green-600">0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ุฏูุชุฑ ุงููููุฏ -->
                <div class="mt-8 bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">ุฏูุชุฑ ุงูููููุฉ ุงูุนุงูุฉ</h3>
                    <div class="overflow-x-auto max-h-64 overflow-y-auto">
                        <table class="w-full text-sm text-right border-collapse">
                            <thead class="bg-gray-800 text-white sticky top-0"><tr><th class="p-2">ุงูุชุงุฑูุฎ</th><th class="p-2">ุงูุจูุงู</th><th class="p-2">ูุฏูู</th><th class="p-2">ุฏุงุฆู</th></tr></thead>
                            <tbody id="journal-body" class="divide-y"></tbody>
                        </table>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <script>
        const VAT_RATE = 0.15;
        
        // --- ุชููุฆุฉ ุงูุจูุงูุงุช ---
        let appData = {
            products: [],
            banks: [], // {id, name, balance}
            sales: [],
            purchases: [],
            expenses: [], // {date, category, amount, paymentMethod, desc}
            journal: [],
            accounts: {
                cash: 0,
                // Bank accounts will be handled dynamically or aggregated
                ar: 0, ap: 0, vat_payable: 0,
                sales_rev: 0, services_rev: 0, other_rev: 0,
                cogs: 0, inventory: 0,
                // Expense Categories Accounts
                exp_rent: 0, exp_utilities: 0, exp_maint: 0,
                exp_salaries: 0, exp_office: 0,
                exp_marketing: 0,
                exp_trans: 0, exp_bank: 0, exp_other: 0
            }
        };

        const expenseNames = {
            'exp_rent': 'ุฅูุฌุงุฑุงุช', 'exp_utilities': 'ููุฑุจุงุก ูููุงู', 'exp_maint': 'ุตูุงูุฉ',
            'exp_salaries': 'ุฑูุงุชุจ ูุฃุฌูุฑ', 'exp_office': 'ูุณุชูุฒูุงุช ููุชุจูุฉ',
            'exp_marketing': 'ุชุณููู ูุฅุนูุงูุงุช',
            'exp_trans': 'ููู ูุดุญู', 'exp_bank': 'ูุตุฑููุงุช ุจูููุฉ', 'exp_other': 'ูุชููุนุฉ'
        };

        // --- ุงูุฏูุงู ุงููุณุงุนุฏุฉ ---
        function loadData() {
            const stored = localStorage.getItem('erp_v4_data');
            if(stored) {
                appData = JSON.parse(stored);
            } else {
                // ุจูุงูุงุช ุงูุชุฑุงุถูุฉ
                appData.products = [{ id: 1, name: 'ูุงุจุชูุจ', cost: 2000, price: 2500, stock: 5 }];
                appData.accounts.inventory = 10000;
                appData.banks = [{id: 'bank_1', name: 'ุจูู ุงูุฑุงุฌุญู', balance: 0}];
                saveData();
            }
            updateUI();
        }

        function saveData() {
            localStorage.setItem('erp_v4_data', JSON.stringify(appData));
            updateUI();
        }

        function resetData() {
            if(confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุฌููุน ุงูุจูุงูุงุชุ')) {
                localStorage.removeItem('erp_v4_data');
                location.reload();
            }
        }

        function addJournalEntry(date, desc, lines) {
            // lines: [{account: 'cash'|'bank_id', debit, credit}]
            appData.journal.unshift({date, desc, lines});
            
            lines.forEach(line => {
                // Update specific Bank
                const bank = appData.banks.find(b => b.id === line.account);
                if (bank) {
                    bank.balance += (line.debit - line.credit);
                } 
                // Update Accounts Object
                else if (appData.accounts[line.account] !== undefined) {
                    const isAssetOrExp = ['cash', 'ar', 'inventory', 'cogs', ...Object.keys(expenseNames)].includes(line.account);
                    if (isAssetOrExp) {
                        appData.accounts[line.account] += (line.debit - line.credit);
                    } else {
                        appData.accounts[line.account] += (line.credit - line.debit);
                    }
                }
            });
        }

        // --- ุฅุฏุงุฑุฉ ุงูุจููู ---
        function addBank() {
            const name = prompt('ุฃุฏุฎู ุงุณู ุงูุจูู ุงูุฌุฏูุฏ:');
            if (name) {
                const id = 'bank_' + Date.now();
                appData.banks.push({id, name, balance: 0});
                saveData();
            }
        }

        function getPaymentOptions() {
            let options = `<option value="cash">ุงูุฎุฒููุฉ ุงูุฑุฆูุณูุฉ (ููุฏู)</option>`;
            appData.banks.forEach(b => {
                options += `<option value="${b.id}">${b.name} (ุจูู)</option>`;
            });
            options += `<option value="credit">ุขุฌู (ุฐูู)</option>`;
            return options;
        }

        // --- ุงูุนูููุงุช ---
        function addProduct(e) {
            e.preventDefault();
            const name = document.getElementById('prod-name').value;
            const cost = parseFloat(document.getElementById('prod-cost').value);
            const price = parseFloat(document.getElementById('prod-price').value);
            const stock = parseInt(document.getElementById('prod-stock').value);

            appData.products.push({ id: Date.now(), name, cost, price, stock });
            if(stock > 0) {
                addJournalEntry(new Date().toISOString(), `ุฑุตูุฏ ุงูุชุชุงุญู: ${name}`, [
                    {account: 'inventory', debit: stock*cost, credit: 0},
                    {account: 'other_rev', debit: 0, credit: stock*cost} // ุชุณููุฉ
                ]);
            }
            e.target.reset();
            saveData();
        }

        function processTransaction(e, type) {
            e.preventDefault();
            const prefix = type === 'sale' ? 'sale' : 'purchase';
            const prodId = parseInt(document.getElementById(`${prefix}-product`).value);
            const qty = parseInt(document.getElementById(`${prefix}-qty`).value);
            const party = document.getElementById(`${prefix}-${type === 'sale' ? 'customer' : 'supplier'}`).value;
            const payMethod = document.getElementById(`${prefix}-payment-method`).value;

            const product = appData.products.find(p => p.id === prodId);
            if(!product) return;

            const date = new Date().toISOString();
            
            if (type === 'sale') {
                if(product.stock < qty) return alert('ุงููููุฉ ุบูุฑ ูุงููุฉ');
                
                const totalInc = product.price * qty;
                const base = totalInc / (1 + VAT_RATE);
                const vat = totalInc - base;
                
                product.stock -= qty;
                appData.sales.push({date, type: 'product', desc: `${product.name} - ${party}`, amount: totalInc, vat, payMethod});

                // ุงููููุฏ
                const debitAcc = payMethod === 'credit' ? 'ar' : payMethod; // cash or bank_id
                addJournalEntry(date, `ุจูุน ููุชุฌ: ${product.name}`, [
                    {account: debitAcc, debit: totalInc, credit: 0},
                    {account: 'sales_rev', debit: 0, credit: base},
                    {account: 'vat_payable', debit: 0, credit: vat}
                ]);
                // ุงูุชูููุฉ
                addJournalEntry(date, `ุชูููุฉ: ${product.name}`, [
                    {account: 'cogs', debit: product.cost * qty, credit: 0},
                    {account: 'inventory', debit: 0, credit: product.cost * qty}
                ]);

            } else { // Purchase
                const totalInc = product.cost * qty; // ุงูุชุฑุงุถ ุงูุชูููุฉ ุดุงููุฉ
                const base = totalInc / (1 + VAT_RATE);
                const vat = totalInc - base;

                product.stock += qty;
                appData.purchases.push({date, supplier: party, product: product.name, amount: totalInc, vat, payMethod});

                const creditAcc = payMethod === 'credit' ? 'ap' : payMethod;
                addJournalEntry(date, `ุดุฑุงุก: ${product.name}`, [
                    {account: 'inventory', debit: base, credit: 0},
                    {account: 'vat_payable', debit: vat, credit: 0}, // ุฎุตู ุถุฑูุจู
                    {account: creditAcc, debit: 0, credit: totalInc}
                ]);
            }
            e.target.reset();
            saveData();
        }

        function processServiceRevenue(e) {
            e.preventDefault();
            const desc = document.getElementById('srv-desc').value;
            const type = document.getElementById('srv-type').value;
            const amount = parseFloat(document.getElementById('srv-amount').value);
            const payMethod = document.getElementById('srv-payment-method').value;

            // ุฅุฐุง ูุงู ุงูุฏูุน ุขุฌูุงูุ ูุฐูุจ ููุนููุงุก
            if(payMethod === 'credit') return alert('ุงูุฅูุฑุงุฏุงุช ุงูุฎุฏููุฉ ุชุชุทูุจ ุฏูุน ููุฏู ุฃู ุจููู ุญุงููุงู (ุฃู ุทูุฑ ุงููุธุงู ููุฐูู)');

            const date = new Date().toISOString();
            // Assuming no VAT for simplicity on services, or add logic
            const base = amount; 
            
            appData.sales.push({date, type: type, desc, amount, vat: 0, payMethod});
            
            addJournalEntry(date, `ุฅูุฑุงุฏ: ${desc}`, [
                {account: payMethod, debit: amount, credit: 0},
                {account: type, debit: 0, credit: amount}
            ]);
            
            e.target.reset();
            saveData();
        }

        function processExpense(e) {
            e.preventDefault();
            const category = document.getElementById('exp-category').value;
            const payMethod = document.getElementById('exp-payment-method').value;
            const amount = parseFloat(document.getElementById('exp-amount').value);
            const desc = document.getElementById('exp-desc').value;
            const date = new Date().toISOString();

            if(payMethod === 'credit') return alert('ุงููุตุฑููุงุช ุชุชุทูุจ ุฏูุน ูู ุงูุฎุฒููุฉ ุฃู ุงูุจูู');

            appData.expenses.push({date, category, amount, payMethod, desc});

            addJournalEntry(date, `ูุตุฑูู: ${expenseNames[category]} - ${desc}`, [
                {account: category, debit: amount, credit: 0},
                {account: payMethod, debit: 0, credit: amount}
            ]);

            e.target.reset();
            saveData();
        }

        // --- ุชุญุฏูุซ ุงููุงุฌูุฉ ---
        function updateUI() {
            // Payment Methods Dropdowns
            const payOpts = getPaymentOptions();
            const paySelects = ['sale-payment-method', 'purchase-payment-method', 'srv-payment-method', 'exp-payment-method'];
            paySelects.forEach(id => {
                const el = document.getElementById(id);
                if(el && el.innerHTML === '') el.innerHTML = payOpts;
            });

            // Product Dropdowns
            const prodOpts = '<option value="">ุงุฎุชุฑ...</option>' + appData.products.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            document.getElementById('sale-product').innerHTML = prodOpts;
            document.getElementById('purchase-product').innerHTML = prodOpts;

            // Finance Section
            document.getElementById('treasury-balance').textContent = appData.accounts.cash.toFixed(2);
            document.getElementById('header-cash').textContent = appData.accounts.cash.toFixed(2);
            
            const totalBank = appData.banks.reduce((sum, b) => sum + b.balance, 0);
            document.getElementById('header-bank').textContent = totalBank.toFixed(2);

            document.getElementById('banks-list').innerHTML = appData.banks.map(b => `
                <div class="flex justify-between p-3 bg-gray-50 rounded border-r-4 border-blue-400">
                    <span>${b.name}</span>
                    <span class="font-bold font-mono">${b.balance.toFixed(2)}</span>
                </div>
            `).join('');

            // Finance Log
            // Combine sales, purchases, expenses that affect cash/bank
            // For simplicity, we can iterate Journal entries
            const financeLogs = appData.journal.filter(entry => 
                entry.lines.some(l => l.account === 'cash' || l.account.startsWith('bank_'))
            ).slice(0, 20); // Last 20

            document.getElementById('finance-log-body').innerHTML = financeLogs.map(e => {
                const cashLine = e.lines.find(l => l.account === 'cash' || l.account.startsWith('bank_'));
                const amount = cashLine.debit > 0 ? cashLine.debit : -cashLine.credit;
                const accName = cashLine.account === 'cash' ? 'ุงูุฎุฒููุฉ' : (appData.banks.find(b=>b.id===cashLine.account)?.name || 'ุจูู');
                return `<tr>
                    <td class="p-2 text-xs text-gray-500">${new Date(e.date).toLocaleDateString()}</td>
                    <td class="p-2 font-bold ${amount>0?'text-green-600':'text-red-600'}">${amount>0?'ูุจุถ':'ุฏูุน'}</td>
                    <td class="p-2">${e.desc}</td>
                    <td class="p-2 font-mono" dir="ltr">${amount.toFixed(2)}</td>
                    <td class="p-2 text-xs bg-gray-100 rounded">${accName}</td>
                </tr>`;
            }).join('');

            // Tables
            renderTable('inventory-body', appData.products, p => `
                <td class="p-2">${p.name}</td>
                <td class="p-2">${p.cost}</td>
                <td class="p-2">${p.price}</td>
                <td class="p-2 font-bold">${p.stock}</td>
                <td class="p-2">${(p.stock*p.cost).toFixed(2)}</td>
            `);

            renderTable('sales-log-body', appData.sales.slice().reverse(), s => `
                <td class="p-2 text-xs">${new Date(s.date).toLocaleDateString()}</td>
                <td class="p-2 badge"><span class="px-2 py-1 rounded text-xs ${s.type==='product'?'bg-blue-100 text-blue-700':'bg-purple-100 text-purple-700'}">${s.type==='product'?'ุจูุน':'ุฎุฏูุฉ'}</span></td>
                <td class="p-2">${s.desc}</td>
                <td class="p-2 font-bold">${s.amount.toFixed(2)}</td>
                <td class="p-2 text-red-500 text-xs">${s.vat.toFixed(2)}</td>
                <td class="p-2 text-xs">${s.payMethod==='cash'?'ููุฏู':(s.payMethod==='credit'?'ุขุฌู':'ุจูู')}</td>
            `);

            renderTable('expenses-log-body', appData.expenses.slice().reverse(), x => `
                <td class="p-2 text-xs">${new Date(x.date).toLocaleDateString()}</td>
                <td class="p-2 text-xs bg-red-50 text-red-700 rounded px-2">${expenseNames[x.category]}</td>
                <td class="p-2">${x.desc}</td>
                <td class="p-2 font-bold">${x.amount.toFixed(2)}</td>
                <td class="p-2 text-xs">${x.payMethod==='cash'?'ููุฏู':'ุจูู'}</td>
            `);

            // Reports Update
            const totalRevenue = appData.accounts.sales_rev + appData.accounts.services_rev + appData.accounts.other_rev;
            const totalExpenses = Object.keys(expenseNames).reduce((sum, key) => sum + appData.accounts[key], 0);
            
            document.getElementById('rpt-sales').textContent = appData.accounts.sales_rev.toFixed(2);
            document.getElementById('rpt-services').textContent = appData.accounts.services_rev.toFixed(2);
            document.getElementById('rpt-other-rev').textContent = appData.accounts.other_rev.toFixed(2);
            document.getElementById('rpt-total-rev').textContent = totalRevenue.toFixed(2);
            document.getElementById('rpt-cogs').textContent = appData.accounts.cogs.toFixed(2);
            document.getElementById('rpt-gross-profit').textContent = (totalRevenue - appData.accounts.cogs).toFixed(2);
            
            // Render Expense List in Report
            document.getElementById('rpt-expenses-list').innerHTML = Object.keys(expenseNames).map(key => {
                const val = appData.accounts[key];
                if(val <= 0) return '';
                return `<div class="flex justify-between"><span>${expenseNames[key]}</span><span>${val.toFixed(2)}</span></div>`;
            }).join('');
            
            document.getElementById('rpt-total-exp').textContent = totalExpenses.toFixed(2);
            
            const netProfit = (totalRevenue - appData.accounts.cogs) - totalExpenses;
            document.getElementById('rpt-net-profit').textContent = netProfit.toFixed(2);
            document.getElementById('rpt-net-profit').className = netProfit >= 0 ? 'text-green-600' : 'text-red-600';

            // Dashboard Widgets
            document.getElementById('dash-revenue').textContent = totalRevenue.toFixed(2);
            document.getElementById('dash-expenses').textContent = totalExpenses.toFixed(2);
            document.getElementById('dash-liquidity').textContent = (appData.accounts.cash + totalBank).toFixed(2);
            document.getElementById('dash-net-profit').textContent = netProfit.toFixed(2);
            
            // Journal Table
             document.getElementById('journal-body').innerHTML = appData.journal.slice(0, 50).map(e => {
                return `
                    <tr class="bg-gray-100 border-b"><td colspan="4" class="p-1 text-xs font-bold text-gray-700">${e.desc} - ${new Date(e.date).toLocaleDateString()}</td></tr>
                    ${e.lines.map(l => `
                        <tr class="text-xs">
                            <td></td>
                            <td class="text-gray-500">${l.account.startsWith('bank_') ? 'ุจูู' : (expenseNames[l.account] || l.account)}</td>
                            <td>${l.debit > 0 ? l.debit.toFixed(2) : '-'}</td>
                            <td>${l.credit > 0 ? l.credit.toFixed(2) : '-'}</td>
                        </tr>
                    `).join('')}
                `;
            }).join('');
        }

        function renderTable(id, data, mapper) {
            document.getElementById(id).innerHTML = data.map(mapper).join('');
        }

        function showSection(id) {
            document.querySelectorAll('.section-content').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            const titles = {
                'dashboard': 'ููุญุฉ ุงูููุงุฏุฉ', 'finance': 'ุงูุฎุฒููุฉ ูุงูุจููู', 
                'inventory': 'ุงููุฎุฒูู', 'sales': 'ุงููุจูุนุงุช ูุงูุฅูุฑุงุฏุงุช', 
                'expenses': 'ุฅุฏุงุฑุฉ ุงููุตุฑููุงุช', 'purchases': 'ุงููุดุชุฑูุงุช', 'accounting': 'ุงูุชูุงุฑูุฑ ุงููุงููุฉ'
            };
            document.getElementById('page-title').textContent = titles[id];
        }

        window.onload = loadData;
    </script>
</body>
</html>
