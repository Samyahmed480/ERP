<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ERP ุงููุชูุงูู (ูุญุงุณุจู ูุถุฑูุจู)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f3f4f6; }
        .currency { font-family: 'Courier New', Courier, monospace; font-weight: bold; }
        .section-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .section-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse-purple { 0% { box-shadow: 0 0 0 0 rgba(147, 51, 234, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(147, 51, 234, 0); } 100% { box-shadow: 0 0 0 0 rgba(147, 51, 234, 0); } }
        .ai-btn:hover { animation: pulse-purple 2s infinite; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        /* Table Styles */
        th { white-space: nowrap; }
    </style>
</head>
<body class="text-gray-800 h-screen flex overflow-hidden">

    <!-- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ -->
    <aside class="w-64 bg-slate-900 text-white flex flex-col shadow-lg transition-all duration-300 z-20" id="sidebar">
        <div class="p-6 border-b border-slate-700 flex items-center justify-center flex-col">
            <h1 class="text-2xl font-bold text-blue-400"><i class="fas fa-cube me-2"></i>ูุธุงู ERP</h1>
            <span class="text-xs text-purple-400 block mt-1">ุงููุญุงุณุจู ุงููุชูุงูู โจ</span>
        </div>
        
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <button onclick="showSection('dashboard')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center bg-slate-800 text-blue-300" data-target="dashboard">
                <i class="fas fa-chart-pie w-6 text-center ml-2"></i> ููุญุฉ ุงูููุงุฏุฉ
            </button>
            <button onclick="showSection('inventory')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center" data-target="inventory">
                <i class="fas fa-boxes w-6 text-center ml-2"></i> ุงููุฎุฒูู ูุงูุฃุตูุงู
            </button>
            <button onclick="showSection('sales')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center" data-target="sales">
                <i class="fas fa-shopping-cart w-6 text-center ml-2"></i> ุงููุจูุนุงุช ูุงูุนููุงุก
            </button>
            <button onclick="showSection('purchases')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center" data-target="purchases">
                <i class="fas fa-truck w-6 text-center ml-2"></i> ุงููุดุชุฑูุงุช ูุงูููุฑุฏูู
            </button>
            <button onclick="showSection('accounting')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center" data-target="accounting">
                <i class="fas fa-calculator w-6 text-center ml-2"></i> ุงููุญุงุณุจุฉ ูุงูุถุฑุงุฆุจ
            </button>
            <button onclick="showSection('reports')" class="nav-btn w-full text-right p-3 rounded-lg hover:bg-slate-700 transition flex items-center" data-target="reports">
                <i class="fas fa-file-invoice-dollar w-6 text-center ml-2"></i> ุงูุชูุงุฑูุฑ ุงูุฎุชุงููุฉ
            </button>
        </nav>

        <div class="p-4 border-t border-slate-700 text-center text-xs text-slate-400">
            ูุณุฎุฉ V3.0 (ูุญุงุณุจุฉ + ุถุฑุงุฆุจ)
        </div>
    </aside>

    <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
    <main class="flex-1 flex flex-col overflow-hidden bg-gray-50">
        <!-- ุฑุฃุณ ุงูุตูุญุฉ -->
        <header class="bg-white shadow-sm p-4 flex justify-between items-center z-10 border-b">
            <h2 id="page-title" class="text-xl font-bold text-gray-700">ููุญุฉ ุงูููุงุฏุฉ</h2>
            <div class="flex items-center gap-4">
                <div class="bg-green-50 text-green-700 px-3 py-1 rounded-full text-sm border border-green-200">
                    <i class="fas fa-wallet me-1"></i> ุฑุตูุฏ ุงูุฎุฒููุฉ: <span id="header-cash" class="font-bold currency">0.00</span>
                </div>
                <button onclick="resetData()" class="text-red-500 text-sm hover:underline"><i class="fas fa-trash-alt"></i> ุชุตููุฑ</button>
                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-md cursor-help" title="ุงููุณุชุดุงุฑ ุงูุฐูู">
                    AI
                </div>
            </div>
        </header>

        <!-- ููุทูุฉ ุงูุนูู -->
        <div class="flex-1 overflow-auto p-6 relative">
            
            <!-- 1. ููุญุฉ ุงูููุงุฏุฉ -->
            <section id="dashboard" class="section-content active">
                <!-- AI Banner -->
                <div class="bg-gradient-to-r from-indigo-700 to-purple-800 rounded-xl shadow-lg p-6 mb-8 text-white relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full bg-white opacity-5 transform -skew-x-12"></div>
                    <div class="relative z-10 flex justify-between items-center flex-wrap gap-4">
                        <div>
                            <h3 class="text-2xl font-bold mb-1"><i class="fas fa-robot me-2"></i> ุงููุณุชุดุงุฑ ุงููุงูู ุงูุฐูู</h3>
                            <p class="text-indigo-100 text-sm opacity-90">ุชุญููู ููุฑู ูููุฑูุฒ ุงููุงููุ ุงูุถุฑุงุฆุจุ ูุงูุชุฑุงุญุงุช ูุฒูุงุฏุฉ ุงูุณูููุฉ.</p>
                        </div>
                        <button onclick="generateBusinessAnalysis()" class="ai-btn bg-white/10 backdrop-blur-md border border-white/30 text-white px-6 py-2 rounded-full font-bold hover:bg-white/20 transition flex items-center gap-2">
                            <i class="fas fa-magic"></i> ุชุญููู ุงููุถุน ุงููุงูู
                        </button>
                    </div>
                    <div id="ai-analysis-result" class="mt-4 hidden bg-black/20 backdrop-blur-sm p-4 rounded-lg text-sm leading-relaxed border border-white/10 text-indigo-50"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border-r-4 border-green-500">
                        <p class="text-sm text-gray-500 mb-1">ุตุงูู ุงููุจูุนุงุช (ุจุฏูู ุถุฑูุจุฉ)</p>
                        <h3 class="text-2xl font-bold text-gray-800 currency" id="dash-net-sales">0.00</h3>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border-r-4 border-blue-500">
                        <p class="text-sm text-gray-500 mb-1">ุตุงูู ุงููุดุชุฑูุงุช (ุจุฏูู ุถุฑูุจุฉ)</p>
                        <h3 class="text-2xl font-bold text-gray-800 currency" id="dash-net-purchases">0.00</h3>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border-r-4 border-red-500">
                        <p class="text-sm text-gray-500 mb-1">ุถุฑูุจุฉ ูุณุชุญูุฉ ููุฏูุน (VAT)</p>
                        <h3 class="text-2xl font-bold text-red-600 currency" id="dash-vat-payable">0.00</h3>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border-r-4 border-purple-500">
                        <p class="text-sm text-gray-500 mb-1">ุตุงูู ุงูุฑุจุญ ุงูุชุดุบููู</p>
                        <h3 class="text-2xl font-bold text-purple-600 currency" id="dash-net-profit">0.00</h3>
                    </div>
                </div>

                <!-- ูุธุฑุฉ ุณุฑูุนุฉ ุนูู ุงูุญุณุงุจุงุช -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">๐ฆ ุญุงูุฉ ุงููุฎุฒูู</h3>
                        <div id="stock-alerts" class="space-y-2"></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">๐ฐ ููุฎุต ุงูุณูููุฉ ูุงูุฐูู</h3>
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded mb-2">
                            <span>ุงูููุฏูุฉ ูู ุงูุฎุฒููุฉ</span>
                            <span class="font-bold text-green-600" id="acc-cash">0.00</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded mb-2">
                            <span>ููุง ุนูุฏ ุงูุนููุงุก (ูุฏูููู)</span>
                            <span class="font-bold text-blue-600" id="acc-receivable">0.00</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                            <span>ุนูููุง ููููุฑุฏูู (ุฏุงุฆููู)</span>
                            <span class="font-bold text-red-600" id="acc-payable">0.00</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. ุงููุฎุฒูู -->
            <section id="inventory" class="section-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-1">
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <h3 class="font-bold text-lg mb-4 text-gray-700">ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ</h3>
                            <form id="product-form" onsubmit="addProduct(event)">
                                <div class="mb-3">
                                    <label class="text-xs text-gray-500">ุงุณู ุงูููุชุฌ</label>
                                    <div class="flex gap-1">
                                        <input type="text" id="prod-name" required class="w-full p-2 border rounded text-sm" placeholder="ูุซุงู: ุขูููู 15">
                                        <button type="button" onclick="generateProductDescription()" class="bg-purple-100 text-purple-600 px-2 rounded text-xs"><i class="fas fa-magic"></i></button>
                                    </div>
                                    <textarea id="prod-desc" rows="2" class="w-full p-2 border rounded mt-1 text-xs bg-gray-50" placeholder="ูุตู ุงูููุชุฌ..."></textarea>
                                </div>
                                <div class="grid grid-cols-2 gap-2 mb-3">
                                    <div>
                                        <label class="text-xs text-gray-500">ุณุนุฑ ุงูุชูููุฉ (ุดุงูู ุงูุถุฑูุจุฉ)</label>
                                        <input type="number" id="prod-cost" step="0.01" required class="w-full p-2 border rounded text-sm">
                                    </div>
                                    <div>
                                        <label class="text-xs text-gray-500">ุณุนุฑ ุงูุจูุน (ุดุงูู ุงูุถุฑูุจุฉ)</label>
                                        <input type="number" id="prod-price" step="0.01" required class="w-full p-2 border rounded text-sm">
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <label class="text-xs text-gray-500">ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู</label>
                                    <input type="number" id="prod-stock" value="0" class="w-full p-2 border rounded text-sm">
                                </div>
                                <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded text-sm hover:bg-indigo-700">ุญูุธ ุงูุตูู</button>
                            </form>
                        </div>
                    </div>
                    <div class="lg:col-span-2">
                        <div class="bg-white p-6 rounded-xl shadow-sm overflow-x-auto">
                            <table class="w-full text-sm text-right">
                                <thead class="bg-gray-100 text-gray-600">
                                    <tr>
                                        <th class="p-3">ุงุณู ุงูููุชุฌ</th>
                                        <th class="p-3">ุงูุชูููุฉ</th>
                                        <th class="p-3">ุณุนุฑ ุงูุจูุน</th>
                                        <th class="p-3">ุงููููุฉ</th>
                                        <th class="p-3">ูููุฉ ุงููุฎุฒูู</th>
                                        <th class="p-3">ุญุฐู</th>
                                    </tr>
                                </thead>
                                <tbody id="inventory-body" class="divide-y"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. ุงููุจูุนุงุช -->
            <section id="sales" class="section-content">
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                    <h3 class="font-bold text-gray-700 border-b pb-2 mb-4">๐ ูุงุชูุฑุฉ ูุจูุนุงุช ุฌุฏูุฏุฉ (ุดุงููุฉ ุงูุถุฑูุจุฉ)</h3>
                    <form onsubmit="processTransaction(event, 'sale')" class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end bg-green-50 p-4 rounded-lg border border-green-100">
                        <div class="md:col-span-1">
                            <label class="text-xs text-gray-500 block mb-1">ุงูุนููู</label>
                            <input type="text" id="sale-customer" placeholder="ุงุณู ุงูุนููู" class="w-full p-2 border rounded text-sm">
                        </div>
                        <div class="md:col-span-1">
                            <label class="text-xs text-gray-500 block mb-1">ุงูููุชุฌ</label>
                            <select id="sale-product" class="w-full p-2 border rounded text-sm bg-white" onchange="updatePrice('sale')"></select>
                        </div>
                        <div class="md:col-span-1">
                            <label class="text-xs text-gray-500 block mb-1">ุงููููุฉ</label>
                            <input type="number" id="sale-qty" value="1" min="1" class="w-full p-2 border rounded text-sm">
                        </div>
                        <div class="md:col-span-1">
                            <label class="text-xs text-gray-500 block mb-1">ููุน ุงูุฏูุน</label>
                            <select id="sale-payment" class="w-full p-2 border rounded text-sm bg-white">
                                <option value="cash">ููุฏู (ูุงุด)</option>
                                <option value="credit">ุขุฌู (ุฐูู)</option>
                            </select>
                        </div>
                        <button type="submit" class="bg-green-600 text-white py-2 px-4 rounded text-sm hover:bg-green-700 h-9">ุฅุตุฏุงุฑ ุงููุงุชูุฑุฉ</button>
                    </form>
                    <div class="mt-2 text-xs text-gray-500 flex gap-4">
                        <span>* ุงูุถุฑูุจุฉ ุงููุนุชูุฏุฉ: 15%</span>
                        <span>* ูุชู ุฅูุดุงุก ููุฏ ูุญุงุณุจู ุชููุงุฆูุงู</span>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm overflow-x-auto">
                    <h3 class="font-bold text-gray-700 mb-4">ุณุฌู ููุงุชูุฑ ุงููุจูุนุงุช</h3>
                    <table class="w-full text-sm text-right">
                        <thead class="bg-green-50 text-green-800">
                            <tr>
                                <th class="p-3">ู</th>
                                <th class="p-3">ุงูุชุงุฑูุฎ</th>
                                <th class="p-3">ุงูุนููู</th>
                                <th class="p-3">ุงูููุชุฌ</th>
                                <th class="p-3">ุงูุฅุฌูุงูู (ุดุงูู)</th>
                                <th class="p-3">ุงูุถุฑูุจุฉ (15%)</th>
                                <th class="p-3">ุงูุฏูุน</th>
                            </tr>
                        </thead>
                        <tbody id="sales-body" class="divide-y"></tbody>
                    </table>
                </div>
            </section>

            <!-- 4. ุงููุดุชุฑูุงุช -->
            <section id="purchases" class="section-content">
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                    <h3 class="font-bold text-gray-700 border-b pb-2 mb-4">๐ ูุงุชูุฑุฉ ูุดุชุฑูุงุช ุฌุฏูุฏุฉ (ุดุงููุฉ ุงูุถุฑูุจุฉ)</h3>
                    <form onsubmit="processTransaction(event, 'purchase')" class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end bg-blue-50 p-4 rounded-lg border border-blue-100">
                        <div class="md:col-span-1">
                            <label class="text-xs text-gray-500 block mb-1">ุงูููุฑุฏ</label>
                            <input type="text" id="purchase-supplier" placeholder="ุงุณู ุงูููุฑุฏ" class="w-full p-2 border rounded text-sm">
                        </div>
                        <div class="md:col-span-1">
                            <label class="text-xs text-gray-500 block mb-1">ุงูููุชุฌ</label>
                            <select id="purchase-product" class="w-full p-2 border rounded text-sm bg-white" onchange="updatePrice('purchase')"></select>
                        </div>
                        <div class="md:col-span-1">
                            <label class="text-xs text-gray-500 block mb-1">ุงููููุฉ</label>
                            <input type="number" id="purchase-qty" value="1" min="1" class="w-full p-2 border rounded text-sm">
                        </div>
                        <div class="md:col-span-1">
                            <label class="text-xs text-gray-500 block mb-1">ููุน ุงูุฏูุน</label>
                            <select id="purchase-payment" class="w-full p-2 border rounded text-sm bg-white">
                                <option value="cash">ููุฏู (ูู ุงูุฎุฒููุฉ)</option>
                                <option value="credit">ุขุฌู (ุฐูู ููุฑุฏูู)</option>
                            </select>
                        </div>
                        <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded text-sm hover:bg-blue-700 h-9">ุชุณุฌูู ุงููุดุชุฑูุงุช</button>
                    </form>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm overflow-x-auto">
                    <h3 class="font-bold text-gray-700 mb-4">ุณุฌู ููุงุชูุฑ ุงููุดุชุฑูุงุช</h3>
                    <table class="w-full text-sm text-right">
                        <thead class="bg-blue-50 text-blue-800">
                            <tr>
                                <th class="p-3">ู</th>
                                <th class="p-3">ุงูุชุงุฑูุฎ</th>
                                <th class="p-3">ุงูููุฑุฏ</th>
                                <th class="p-3">ุงูููุชุฌ</th>
                                <th class="p-3">ุงูุฅุฌูุงูู (ุดุงูู)</th>
                                <th class="p-3">ุงูุถุฑูุจุฉ (15%)</th>
                                <th class="p-3">ุงูุฏูุน</th>
                            </tr>
                        </thead>
                        <tbody id="purchases-body" class="divide-y"></tbody>
                    </table>
                </div>
            </section>

            <!-- 5. ุงููุญุงุณุจุฉ ูุงูุถุฑุงุฆุจ -->
            <section id="accounting" class="section-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- ุงูุฅูุฑุงุฑ ุงูุถุฑูุจู ุงููุจุณุท -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-red-500">
                        <h3 class="font-bold text-lg mb-4 text-gray-700 flex justify-between">
                            <span>๐ ุงูุฅูุฑุงุฑ ุงูุถุฑูุจู (VAT Report)</span>
                            <span class="text-xs bg-gray-200 px-2 py-1 rounded">ูุณุจุฉ 15%</span>
                        </h3>
                        <div class="space-y-3">
                            <div class="flex justify-between p-3 bg-gray-50 rounded">
                                <span>ุถุฑูุจุฉ ุงููุจูุนุงุช (Output VAT)</span>
                                <span class="font-bold text-gray-700 currency" id="tax-output">0.00</span>
                            </div>
                            <div class="flex justify-between p-3 bg-gray-50 rounded">
                                <span>ุถุฑูุจุฉ ุงููุดุชุฑูุงุช (Input VAT)</span>
                                <span class="font-bold text-gray-700 currency" id="tax-input">0.00</span>
                            </div>
                            <div class="flex justify-between p-3 bg-red-50 rounded border border-red-100">
                                <span class="font-bold text-red-700">ุตุงูู ุงูุถุฑูุจุฉ ุงููุณุชุญูุฉ</span>
                                <span class="font-bold text-red-700 currency" id="tax-net">0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- ุงูุฃุฑุตุฏุฉ ุงูุญุงููุฉ -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-indigo-500">
                        <h3 class="font-bold text-lg mb-4 text-gray-700">๐ฆ ุงููููู ุงููุงูู (Financial Position)</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">ุงูููุฏูุฉ ููุง ูู ุญูููุง</span>
                                <span class="font-bold text-green-600 currency" id="fin-cash">0.00</span>
                            </div>
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">ุงููุฏูููู (ุงูุนููุงุก)</span>
                                <span class="font-bold text-blue-600 currency" id="fin-ar">0.00</span>
                            </div>
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">ุงููุฎุฒูู (ุจุณุนุฑ ุงูุชูููุฉ)</span>
                                <span class="font-bold text-orange-600 currency" id="fin-inv">0.00</span>
                            </div>
                            <div class="flex justify-between pt-2">
                                <span class="text-gray-600">ุงูุฏุงุฆููู (ุงูููุฑุฏูู)</span>
                                <span class="font-bold text-red-600 currency" id="fin-ap">0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ุฏูุชุฑ ุงููููุฏ ุงูููููุฉ -->
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">๐ ุฏูุชุฑ ุงูููููุฉ ุงูุนุงูุฉ (Journal Entries)</h3>
                    <div class="overflow-x-auto max-h-96 overflow-y-auto">
                        <table class="w-full text-sm text-right border-collapse">
                            <thead class="bg-gray-800 text-white sticky top-0">
                                <tr>
                                    <th class="p-3">ุงูุชุงุฑูุฎ</th>
                                    <th class="p-3">ุงูุจูุงู (ุงููุตู)</th>
                                    <th class="p-3">ุงูุญุณุงุจ</th>
                                    <th class="p-3 text-left">ูุฏูู (Debit)</th>
                                    <th class="p-3 text-left">ุฏุงุฆู (Credit)</th>
                                </tr>
                            </thead>
                            <tbody id="journal-body" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 6. ุงูุชูุงุฑูุฑ ุงูุฎุชุงููุฉ -->
            <section id="reports" class="section-content">
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6 max-w-4xl mx-auto border border-gray-200">
                    <div class="text-center mb-6 border-b pb-4">
                        <h2 class="text-2xl font-bold text-gray-800">ูุงุฆูุฉ ุงูุฏุฎู (Income Statement)</h2>
                        <p class="text-sm text-gray-500">ุนู ุงููุชุฑุฉ ุงูุญุงููุฉ</p>
                    </div>
                    
                    <div class="space-y-4 text-sm md:text-base">
                        <div class="flex justify-between">
                            <span class="font-bold text-gray-700">ุฅุฌูุงูู ุงููุจูุนุงุช (Revenue)</span>
                            <span class="font-bold text-gray-800" id="inc-revenue">0.00</span>
                        </div>
                        <div class="flex justify-between text-red-500">
                            <span>(-) ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ (COGS)</span>
                            <span id="inc-cogs">0.00</span>
                        </div>
                        <div class="border-t border-gray-300 my-2"></div>
                        <div class="flex justify-between text-lg bg-gray-50 p-2 rounded">
                            <span class="font-bold text-indigo-700">ูุฌูู ุงูุฑุจุญ (Gross Profit)</span>
                            <span class="font-bold text-indigo-700" id="inc-gross">0.00</span>
                        </div>
                        
                        <div class="mt-4">
                            <p class="text-gray-500 text-xs mb-2">ูุตุฑููุงุช ุฃุฎุฑู</p>
                            <div class="flex justify-between text-gray-600 pl-4">
                                <span>ูุตุฑููุงุช ุชุดุบูููุฉ (ุชุฌุฑูุจู)</span>
                                <span>0.00</span>
                            </div>
                        </div>

                        <div class="border-t-2 border-gray-800 my-4"></div>
                        <div class="flex justify-between text-xl font-bold p-3 bg-green-100 rounded text-green-800">
                            <span>ุตุงูู ุงูุฑุจุญ (Net Profit)</span>
                            <span id="inc-net">0.00</span>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <script>
        // --- ุฅุนุฏุงุฏุงุช ุงููุธุงู ---
        const apiKey = ""; // ุณูุชู ุชูููุฑูุง ูู ุงูุจูุฆุฉ
        const VAT_RATE = 0.15; // ูุณุจุฉ ุงูุถุฑูุจุฉ 15%

        // --- ูููู ุงูุจูุงูุงุช ---
        let appData = {
            products: [],
            sales: [],
            purchases: [],
            journal: [], // ุฏูุชุฑ ุงูููููุฉ
            accounts: {
                cash: 0,        // ููุฏูุฉ
                ar: 0,          // ุนููุงุก (ูุฏูููู)
                ap: 0,          // ููุฑุฏูู (ุฏุงุฆููู)
                vat_payable: 0, // ุถุฑุงุฆุจ ูุณุชุญูุฉ
                sales_rev: 0,   // ุฅูุฑุงุฏุงุช ูุจูุนุงุช
                cogs: 0,        // ุชูููุฉ ุจุถุงุนุฉ ูุจุงุนุฉ
                inventory: 0    // ูููุฉ ุงููุฎุฒูู
            }
        };

        // --- Gemini AI Functions ---
        async function callGeminiAPI(prompt) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            try {
                const response = await fetch(url, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload)});
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) { console.error(error); return "ุชุนุฐุฑ ุงูุงุชุตุงู ุจุงูุฎุงุฏู."; }
        }

        async function generateProductDescription() {
            const name = document.getElementById('prod-name').value;
            if(!name) return alert('ุงูุชุจ ุงุณู ุงูููุชุฌ ุฃููุงู');
            document.getElementById('prod-desc').value = "ุฌุงุฑู ุงูุชูููุฏ...";
            const desc = await callGeminiAPI(`ุงูุชุจ ูุตูุง ุชุณููููุง ูุตูุฑุง ุฌุฏุง (ุณุทุฑ ูุงุญุฏ) ูููุชุฌ: ${name}`);
            document.getElementById('prod-desc').value = desc.trim();
        }

        async function generateBusinessAnalysis() {
            const box = document.getElementById('ai-analysis-result');
            box.classList.remove('hidden');
            box.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช ุงููุงููุฉ...';
            
            const prompt = `ุจุตูุชู ูุณุชุดุงุฑุงู ูุงููุงูุ ุญูู ูุฐู ุงูุจูุงูุงุช ูุดุฑูุฉ ุตุบูุฑุฉ:
            - ุงูููุฏูุฉ: ${appData.accounts.cash}
            - ุงูุฐูู ุงููุฏููุฉ (ุนูุฏ ุงูุนููุงุก): ${appData.accounts.ar}
            - ุงูุฐูู ุงูุฏุงุฆูุฉ (ููููุฑุฏูู): ${appData.accounts.ap}
            - ุตุงูู ุงูุถุฑูุจุฉ ุงููุณุชุญูุฉ: ${appData.accounts.vat_payable}
            - ุตุงูู ุงูุฑุจุญ: ${appData.accounts.sales_rev - appData.accounts.cogs}
            
            ูุฏู 3 ูุตุงุฆุญ ูุฑูุฒุฉ ุฌุฏุงู ููุญูุงุธ ุนูู ุงูุณูููุฉ ูุชูููู ุงูุถุฑุงุฆุจ ุจุดูู ูุงูููู.`;
            
            const result = await callGeminiAPI(prompt);
            box.innerHTML = `<strong>ุชูุฑูุฑ ุงููุณุชุดุงุฑ ุงููุงูู:</strong><br>${result.replace(/\n/g, '<br>')}`;
        }

        // --- ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช ---
        function loadData() {
            const stored = localStorage.getItem('erp_v3_data');
            if(stored) {
                appData = JSON.parse(stored);
            } else {
                // ุจูุงูุงุช ุฃูููุฉ
                appData.products = [
                    { id: 1, name: 'ูุงุจุชูุจ ุฏูู', cost: 2000, price: 2500, stock: 5 }
                ];
                // ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุฃุฑุตุฏุฉ ุงูุงูุชุชุงุญูุฉ ูููุฎุฒูู
                appData.accounts.inventory = 10000; 
                saveData();
            }
            updateUI();
        }

        function saveData() {
            localStorage.setItem('erp_v3_data', JSON.stringify(appData));
            updateUI();
        }

        function resetData() {
            if(confirm('ุชูุจูู: ุณูุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงููุงููุฉ ูุงููุญุงุณุจูุฉ!')) {
                localStorage.removeItem('erp_v3_data');
                location.reload();
            }
        }

        // --- ุงููุญุฑู ุงููุญุงุณุจู (Accounting Engine) ---
        function addJournalEntry(date, desc, entries) {
            // entries = [{ account: 'cash', debit: 100, credit: 0 }, ...]
            const entryId = Date.now();
            
            entries.forEach(line => {
                // ุชุญุฏูุซ ุฃุฑุตุฏุฉ ุงูุญุณุงุจุงุช ุงูุฑุฆูุณูุฉ
                if(appData.accounts[line.account] !== undefined) {
                    // ุทุจูุนุฉ ุงูุญุณุงุจุงุช:
                    // ุฃุตูู (cash, ar, inventory): ุชุฒูุฏ ุจุงููุฏูู (Debit) ูุชููุต ุจุงูุฏุงุฆู (Credit)
                    // ุงูุชุฒุงูุงุช (ap, vat_payable): ุชุฒูุฏ ุจุงูุฏุงุฆู ูุชููุต ุจุงููุฏูู
                    // ุฅูุฑุงุฏุงุช (sales_rev): ุชุฒูุฏ ุจุงูุฏุงุฆู
                    // ูุตุฑููุงุช (cogs): ุชุฒูุฏ ุจุงููุฏูู
                    
                    const isAsset = ['cash', 'ar', 'inventory', 'cogs'].includes(line.account);
                    if(isAsset) {
                        appData.accounts[line.account] += (line.debit - line.credit);
                    } else {
                        appData.accounts[line.account] += (line.credit - line.debit);
                    }
                }
            });

            appData.journal.unshift({ id: entryId, date, desc, lines: entries });
        }

        // --- ุงูุนูููุงุช ---
        function addProduct(e) {
            e.preventDefault();
            const name = document.getElementById('prod-name').value;
            const cost = parseFloat(document.getElementById('prod-cost').value);
            const price = parseFloat(document.getElementById('prod-price').value);
            const stock = parseInt(document.getElementById('prod-stock').value);

            const prod = { id: Date.now(), name, cost, price, stock };
            appData.products.push(prod);
            
            // ููุฏ ูุฎุฒูู ุงูุชุชุงุญู (Inventory Adjustment)
            if(stock > 0) {
                const value = stock * cost;
                addJournalEntry(new Date().toISOString(), `ุฑุตูุฏ ุงูุชุชุงุญู: ${name}`, [
                    { account: 'inventory', debit: value, credit: 0 },
                    { account: 'equity_opening', debit: 0, credit: value } // ุญุณุงุจ ูุณูุท
                ]);
            }
            
            document.getElementById('product-form').reset();
            saveData();
            alert('ุชูุช ุฅุถุงูุฉ ุงูุตูู ูุชุญุฏูุซ ูููุฉ ุงููุฎุฒูู');
        }

        function processTransaction(e, type) {
            e.preventDefault();
            const prefix = type === 'sale' ? 'sale' : 'purchase';
            const prodId = parseInt(document.getElementById(`${prefix}-product`).value);
            const qty = parseInt(document.getElementById(`${prefix}-qty`).value);
            const party = document.getElementById(`${prefix}-${type === 'sale' ? 'customer' : 'supplier'}`).value;
            const paymentType = document.getElementById(`${prefix}-payment`).value;

            const product = appData.products.find(p => p.id === prodId);
            if(!product) return;

            const date = new Date().toISOString();

            if (type === 'sale') {
                if(product.stock < qty) return alert('ุงููููุฉ ุบูุฑ ูุชููุฑุฉ!');
                
                // ุญุณุงุจุงุช ุงูุจูุน
                const unitPrice = product.price; // ุงูุณุนุฑ ุดุงูู ุงูุถุฑูุจุฉ
                const totalIncVat = unitPrice * qty;
                const baseAmount = totalIncVat / (1 + VAT_RATE);
                const vatAmount = totalIncVat - baseAmount;
                const costAmount = product.cost * qty;

                // 1. ุชุญุฏูุซ ุงููุฎุฒูู
                product.stock -= qty;

                // 2. ุชุณุฌูู ุงููุงุชูุฑุฉ
                appData.sales.unshift({
                    id: Date.now(), date, party, prodName: product.name,
                    qty, total: totalIncVat, vat: vatAmount, paymentType
                });

                // 3. ุงููููุฏ ุงููุญุงุณุจูุฉ (ุจูุน)
                // ูู ุญ/ ุงูููุฏูุฉ ุฃู ุงูุนููุงุก
                // ุฅูู ุญ/ ุงููุจูุนุงุช
                // ุฅูู ุญ/ ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ
                const debitAccount = paymentType === 'cash' ? 'cash' : 'ar';
                addJournalEntry(date, `ูุงุชูุฑุฉ ุจูุน #${appData.sales.length} - ${party}`, [
                    { account: debitAccount, debit: totalIncVat, credit: 0 },
                    { account: 'sales_rev', debit: 0, credit: baseAmount },
                    { account: 'vat_payable', debit: 0, credit: vatAmount }
                ]);

                // 4. ููุฏ ุงูุชูููุฉ (Cost of Goods Sold)
                // ูู ุญ/ ุชูููุฉ ุงูุจุถุงุนุฉ
                // ุฅูู ุญ/ ุงููุฎุฒูู
                addJournalEntry(date, `ุชูููุฉ ุจุถุงุนุฉ ูุจุงุนุฉ - ${product.name}`, [
                    { account: 'cogs', debit: costAmount, credit: 0 },
                    { account: 'inventory', debit: 0, credit: costAmount }
                ]);

            } else { // Purchase
                // ุญุณุงุจุงุช ุงูุดุฑุงุก
                const unitCost = product.cost; // ุงูุชูููุฉ ุดุงููุฉ ุงูุถุฑูุจุฉ (ููุชุฑุถ ุฐูู ููุชุจุณูุท)
                const totalIncVat = unitCost * qty;
                const baseAmount = totalIncVat / (1 + VAT_RATE);
                const vatAmount = totalIncVat - baseAmount;

                // 1. ุชุญุฏูุซ ุงููุฎุฒูู
                product.stock += qty;

                // 2. ุชุณุฌูู ุงููุงุชูุฑุฉ
                appData.purchases.unshift({
                    id: Date.now(), date, party, prodName: product.name,
                    qty, total: totalIncVat, vat: vatAmount, paymentType
                });

                // 3. ุงููููุฏ ุงููุญุงุณุจูุฉ (ุดุฑุงุก)
                // ูู ุญ/ ุงููุฎุฒูู (ุจุงูุตุงูู)
                // ูู ุญ/ ุถุฑูุจุฉ ุงููุฏุฎูุงุช (ุชุฎุตู ูู ุงูุงูุชุฒุงู ุงูุถุฑูุจู) -> ูุนุงูุฌูุง ููุฏูู ูู vat_payable
                // ุฅูู ุญ/ ุงูููุฏูุฉ ุฃู ุงูููุฑุฏูู
                const creditAccount = paymentType === 'cash' ? 'cash' : 'ap';
                
                // ููุงุญุธุฉ: ููุง ุณูุถุน ุงููุฎุฒูู ุจุณุนุฑ ุงูุชูููุฉ ุงูุตุงููุ ูุงูุถุฑูุจุฉ ุชุณุชุฑุฏ
                // ููู ููุชุจุณูุท ูู ูุฐุง ุงูุชุทุจููุ ุณูุนุชุจุฑ ุงููุฎุฒูู ูุณุฌู ุจุงููููุฉ ุงูุตุงููุฉ
                addJournalEntry(date, `ูุงุชูุฑุฉ ุดุฑุงุก - ${party}`, [
                    { account: 'inventory', debit: baseAmount, credit: 0 },
                    { account: 'vat_payable', debit: vatAmount, credit: 0 }, // ูุฏูู ูุนูู ูููู ุงูุถุฑูุจุฉ ุงููุณุชุญูุฉ
                    { account: creditAccount, debit: 0, credit: totalIncVat }
                ]);
            }

            document.getElementById(type === 'sale' ? 'sales-form' : 'purchase-form').reset(); // Reset doesn't work directly on div forms like this usually, simplified here
            saveData();
            alert('ุชูุช ุงูุนูููุฉ ูุชุณุฌูู ุงููููุฏ ุจูุฌุงุญ');
        }

        // --- ุชุญุฏูุซ ุงููุงุฌูุฉ ---
        function updateUI() {
            // ุชุญุฏูุซ ุงูููุงุฆู ุงูููุณุฏูุฉ
            const opts = '<option value="">ุงุฎุชุฑ...</option>' + appData.products.map(p => `<option value="${p.id}">${p.name} (ูุชููุฑ: ${p.stock})</option>`).join('');
            document.getElementById('sale-product').innerHTML = opts;
            document.getElementById('purchase-product').innerHTML = opts;

            // ุงูุฌุฏุงูู
            renderTable('inventory-body', appData.products, (p) => `
                <td class="p-3 font-bold">${p.name}</td>
                <td class="p-3 text-gray-500">${p.cost}</td>
                <td class="p-3 text-green-600">${p.price}</td>
                <td class="p-3 font-bold">${p.stock}</td>
                <td class="p-3">${(p.stock * p.cost).toFixed(2)}</td>
                <td class="p-3"><button class="text-red-500" onclick="alert('ุบูุฑ ููุนู ูู ุงููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ')">x</button></td>
            `);

            renderTable('sales-body', appData.sales, (s, i) => `
                <td class="p-3">${i+1}</td>
                <td class="p-3 text-xs text-gray-500">${new Date(s.date).toLocaleDateString()}</td>
                <td class="p-3">${s.party}</td>
                <td class="p-3">${s.prodName}</td>
                <td class="p-3 font-bold">${s.total.toFixed(2)}</td>
                <td class="p-3 text-red-500 text-xs">${s.vat.toFixed(2)}</td>
                <td class="p-3 badge"><span class="px-2 py-1 rounded text-xs ${s.paymentType=='cash'?'bg-green-100 text-green-700':'bg-yellow-100 text-yellow-700'}">${s.paymentType=='cash'?'ููุฏู':'ุขุฌู'}</span></td>
            `);

            renderTable('purchases-body', appData.purchases, (p, i) => `
                <td class="p-3">${i+1}</td>
                <td class="p-3 text-xs text-gray-500">${new Date(p.date).toLocaleDateString()}</td>
                <td class="p-3">${p.party}</td>
                <td class="p-3">${p.prodName}</td>
                <td class="p-3 font-bold">${p.total.toFixed(2)}</td>
                <td class="p-3 text-blue-500 text-xs">${p.vat.toFixed(2)}</td>
                <td class="p-3"><span class="px-2 py-1 rounded text-xs ${p.paymentType=='cash'?'bg-red-100 text-red-700':'bg-yellow-100 text-yellow-700'}">${p.paymentType=='cash'?'ููุฏู':'ุขุฌู'}</span></td>
            `);

            // ุฏูุชุฑ ุงูููููุฉ
            const journalBody = document.getElementById('journal-body');
            journalBody.innerHTML = appData.journal.map(entry => {
                let rows = '';
                entry.lines.forEach((line, idx) => {
                    const accNames = {
                        'cash': 'ุงูุตูุฏูู/ุงูุฎุฒููุฉ', 'ar': 'ุงูุนููุงุก (ุฐูู ูุฏููุฉ)', 'ap': 'ุงูููุฑุฏูู (ุฐูู ุฏุงุฆูุฉ)',
                        'sales_rev': 'ุงููุจูุนุงุช', 'cogs': 'ุชูููุฉ ุงูุจุถุงุนุฉ', 'inventory': 'ุงููุฎุฒูู',
                        'vat_payable': 'ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ', 'equity_opening': 'ุฑุฃุณ ุงููุงู ุงูุงูุชุชุงุญู'
                    };
                    rows += `
                        <tr class="text-xs ${idx === 0 ? 'border-t border-gray-300' : ''} hover:bg-gray-50">
                            ${idx === 0 ? `<td class="p-2 align-top text-gray-500" rowspan="${entry.lines.length}">${new Date(entry.date).toLocaleDateString()}</td>` : ''}
                            ${idx === 0 ? `<td class="p-2 align-top font-bold text-gray-700" rowspan="${entry.lines.length}">${entry.desc}</td>` : ''}
                            <td class="p-2 text-gray-600">${accNames[line.account] || line.account}</td>
                            <td class="p-2 text-left ${line.debit > 0 ? 'text-gray-800' : 'text-gray-300'}">${line.debit > 0 ? line.debit.toFixed(2) : '-'}</td>
                            <td class="p-2 text-left ${line.credit > 0 ? 'text-gray-800' : 'text-gray-300'}">${line.credit > 0 ? line.credit.toFixed(2) : '-'}</td>
                        </tr>
                    `;
                });
                return rows;
            }).join('');

            // ุชุญุฏูุซ ุงูุฃุฑูุงู ูุงูุจุทุงูุงุช
            updateDashboardNumbers();
        }

        function renderTable(id, data, rowMapper) {
            document.getElementById(id).innerHTML = data.map(rowMapper).join('');
        }

        function updateDashboardNumbers() {
            // Header Cash
            document.getElementById('header-cash').textContent = appData.accounts.cash.toFixed(2);

            // Dashboard Cards
            document.getElementById('dash-net-sales').textContent = appData.accounts.sales_rev.toFixed(2);
            // Purchases calculation roughly (Inventory Inflow)
            const purchaseTotal = appData.purchases.reduce((acc, p) => acc + (p.total - p.vat), 0);
            document.getElementById('dash-net-purchases').textContent = purchaseTotal.toFixed(2);
            
            document.getElementById('dash-vat-payable').textContent = appData.accounts.vat_payable.toFixed(2);
            document.getElementById('dash-net-profit').textContent = (appData.accounts.sales_rev - appData.accounts.cogs).toFixed(2);

            // Accounting Section
            document.getElementById('tax-output').textContent = appData.sales.reduce((a, b) => a + b.vat, 0).toFixed(2);
            document.getElementById('tax-input').textContent = appData.purchases.reduce((a, b) => a + b.vat, 0).toFixed(2);
            document.getElementById('tax-net').textContent = appData.accounts.vat_payable.toFixed(2);

            document.getElementById('fin-cash').textContent = appData.accounts.cash.toFixed(2);
            document.getElementById('fin-ar').textContent = appData.accounts.ar.toFixed(2);
            document.getElementById('fin-inv').textContent = appData.accounts.inventory.toFixed(2);
            document.getElementById('fin-ap').textContent = appData.accounts.ap.toFixed(2);

            // Income Statement
            document.getElementById('inc-revenue').textContent = appData.accounts.sales_rev.toFixed(2);
            document.getElementById('inc-cogs').textContent = appData.accounts.cogs.toFixed(2);
            document.getElementById('inc-gross').textContent = (appData.accounts.sales_rev - appData.accounts.cogs).toFixed(2);
            document.getElementById('inc-net').textContent = (appData.accounts.sales_rev - appData.accounts.cogs).toFixed(2);
        }

        function showSection(id) {
            document.querySelectorAll('.section-content').forEach(d => d.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            // Highlight sidebar
            document.querySelectorAll('.nav-btn').forEach(b => {
                if(b.dataset.target === id) b.classList.add('bg-slate-800', 'text-blue-300');
                else b.classList.remove('bg-slate-800', 'text-blue-300');
            });
            
            const titles = { 'dashboard': 'ููุญุฉ ุงูููุงุฏุฉ', 'inventory': 'ุงููุฎุฒูู', 'sales': 'ุงููุจูุนุงุช', 'purchases': 'ุงููุดุชุฑูุงุช', 'accounting': 'ุงููุญุงุณุจุฉ ูุงูุถุฑุงุฆุจ', 'reports': 'ุงูุชูุงุฑูุฑ' };
            document.getElementById('page-title').textContent = titles[id];
        }

        // --- ุชููุฆุฉ ุงููุธุงู ---
        window.onload = loadData;
    </script>
</body>
</html>
